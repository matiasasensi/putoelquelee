<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR.js + PNG Effect</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
  </style>
</head>

<body>

<a-scene
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false;"
  vr-mode-ui="enabled: false"
>

  <!-- MARKER PRESET -->
  <a-marker preset="hiro" id="marker">

    <!-- MODELO 3D -->
    <a-entity
      id="model"
      gltf-model="materiales/fakemogus.glb"
      scale="0.5 0.5 0.5"
      position="0 0 0"
      animation-mixer
    ></a-entity>

    <!-- PNG +1 -->
    <a-image
      id="plus1"
      src="materiales/plus1.png"
      position="0 -0.25 0"
      scale="0.3 0.3 0.3"
      visible="false"
      transparent="true"
      material="shader: flat; opacity: 1"
    ></a-image>

  </a-marker>

  <a-camera></a-camera>

</a-scene>

<audio id="clickSound" src="materiales/click.mp3"></audio>

<script>
  const marker = document.querySelector("#marker");
  const plus1 = document.querySelector("#plus1");
  const sound = document.querySelector("#clickSound");

  let markerVisible = false;

  marker.addEventListener("markerFound", () => {
    markerVisible = true;
  });

  marker.addEventListener("markerLost", () => {
    markerVisible = false;
  });

  function lanzarPlus1() {
    if (!markerVisible) return;

    sound.currentTime = 0;
    sound.play();

    plus1.setAttribute("visible", true);
    plus1.setAttribute("position", "0 -0.25 0");
    plus1.setAttribute("scale", "0.3 0.3 0.3");
    plus1.setAttribute("material", "opacity: 1");

    // SUBE
    plus1.setAttribute("animation__move", {
      property: "position",
      to: "0 0.2 0",
      dur: 700,
      easing: "easeOutQuad"
    });

    // CRECE
    plus1.setAttribute("animation__scale", {
      property: "scale",
      to: "0.6 0.6 0.6",
      dur: 700,
      easing: "easeOutQuad"
    });

    // DESVANECE
    plus1.setAttribute("animation__fade", {
      property: "material.opacity",
      to: 0,
      dur: 700,
      easing: "linear"
    });

    setTimeout(() => {
      plus1.setAttribute("visible", false);
    }, 700);
  }

  // CLICK / TAP
  document.body.addEventListener("click", lanzarPlus1);
</script>

</body>
</html>
